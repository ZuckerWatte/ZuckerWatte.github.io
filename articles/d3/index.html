<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width">
    <title>D3 Data-Driven Documents - A Generated Static Site
    </title>
    <link rel="alternate" href="http://localhost:8080/feed.xml" type="application/rss+xml" title="This site is built with Wintersmith, a Node.js based static site generator">
    <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic|Anonymous+Pro:400,700,400italic,700italic|Merriweather:400,700,300">
    <link rel="stylesheet" href="/css/main.css">
    <script src="/scripts/app.js"></script>
  </head>
  <body class="article-detail">
    <header class="header">
      <div class="content-wrap">
        <h1>D3 Data-Driven Documents</h1>
        <p class="author">Written by 
          <!--a(href=contents.about.index.url) hui --><a href="/authors/">Mona</a>
        </p>
      </div>
    </header>
    <div id="content">
      <div class="content-wrap">
        <article class="article">
          <section class="content"><div class="row">
  <div class="col-sm-6" id="task01"><svg viewBox="0 0 800 600" id="chart-aad68792-9265-4db3-af5c-cd526f0f3673">
  <g transform=""/>
<g class="x axis" transform="translate(55, 450)"><g class="tick" style="opacity: 1;" transform="translate(44,0)"><line y2="6" x2="0"/><text dy=".5em" style="text-anchor: end;" y="9" x="0" dx="-.5em" transform="rotate(-45)">Italian</text></g><g class="tick" style="opacity: 1;" transform="translate(117,0)"><line y2="6" x2="0"/><text dy=".5em" style="text-anchor: end;" y="9" x="0" dx="-.5em" transform="rotate(-45)">British</text></g><g class="tick" style="opacity: 1;" transform="translate(190,0)"><line y2="6" x2="0"/><text dy=".5em" style="text-anchor: end;" y="9" x="0" dx="-.5em" transform="rotate(-45)">Belgian</text></g><g class="tick" style="opacity: 1;" transform="translate(263,0)"><line y2="6" x2="0"/><text dy=".5em" style="text-anchor: end;" y="9" x="0" dx="-.5em" transform="rotate(-45)">American</text></g><g class="tick" style="opacity: 1;" transform="translate(336,0)"><line y2="6" x2="0"/><text dy=".5em" style="text-anchor: end;" y="9" x="0" dx="-.5em" transform="rotate(-45)">German</text></g><g class="tick" style="opacity: 1;" transform="translate(409,0)"><line y2="6" x2="0"/><text dy=".5em" style="text-anchor: end;" y="9" x="0" dx="-.5em" transform="rotate(-45)">Dutch</text></g><g class="tick" style="opacity: 1;" transform="translate(482,0)"><line y2="6" x2="0"/><text dy=".5em" style="text-anchor: end;" y="9" x="0" dx="-.5em" transform="rotate(-45)">French</text></g><g class="tick" style="opacity: 1;" transform="translate(555,0)"><line y2="6" x2="0"/><text dy=".5em" style="text-anchor: end;" y="9" x="0" dx="-.5em" transform="rotate(-45)">Spanish</text></g><g class="tick" style="opacity: 1;" transform="translate(628,0)"><line y2="6" x2="0"/><text dy=".5em" style="text-anchor: end;" y="9" x="0" dx="-.5em" transform="rotate(-45)">New Zealander</text></g><g class="tick" style="opacity: 1;" transform="translate(701,0)"><line y2="6" x2="0"/><text dy=".5em" style="text-anchor: end;" y="9" x="0" dx="-.5em" transform="rotate(-45)">Swedish</text></g><path class="domain" d="M-4,6V0H745V4"/></g><g class="y axis" transform="translate(55, 0)"><g class="tick" style="opacity: 1;" transform="translate(0,450)"><line x2="-6" y2="0"/><text dy=".32em" style="text-anchor: end;" x="-9" y="0">0</text></g><g class="tick" style="opacity: 1;" transform="translate(0,400)"><line x2="-6" y2="0"/><text dy=".32em" style="text-anchor: end;" x="-9" y="0">1</text></g><g class="tick" style="opacity: 1;" transform="translate(0,350)"><line x2="-6" y2="0"/><text dy=".32em" style="text-anchor: end;" x="-9" y="0">2</text></g><g class="tick" style="opacity: 1;" transform="translate(0,300.00000000000006)"><line x2="-6" y2="0"/><text dy=".32em" style="text-anchor: end;" x="-9" y="0">3</text></g><g class="tick" style="opacity: 1;" transform="translate(0,250)"><line x2="-6" y2="0"/><text dy=".32em" style="text-anchor: end;" x="-9" y="0">4</text></g><g class="tick" style="opacity: 1;" transform="translate(0,200)"><line x2="-6" y2="0"/><text dy=".32em" style="text-anchor: end;" x="-9" y="0">5</text></g><g class="tick" style="opacity: 1;" transform="translate(0,150.00000000000003)"><line x2="-6" y2="0"/><text dy=".32em" style="text-anchor: end;" x="-9" y="0">6</text></g><g class="tick" style="opacity: 1;" transform="translate(0,100)"><line x2="-6" y2="0"/><text dy=".32em" style="text-anchor: end;" x="-9" y="0">7</text></g><g class="tick" style="opacity: 1;" transform="translate(0,50.00000000000002)"><line x2="-6" y2="0"/><text dy=".32em" style="text-anchor: end;" x="-9" y="0">8</text></g><g class="tick" style="opacity: 1;" transform="translate(0,8)"><line x2="-6" y2="0"/><text dy=".32em" style="text-anchor: end;" x="-9" y="0">9</text></g><path class="domain" d="M-3,0H0V450H-4"/><text transform="rotate(-90)" y="6" dy="0.71em" style="text-anchor: end;">Count</text></g><rect class="bar" x="66" width="66" y="200" height="250"/><rect class="bar" x="139" width="66" y="200" height="250"/><rect class="bar" x="212" width="66" y="400" height="50"/><rect class="bar" x="285" width="66" y="0" height="450"/><rect class="bar" x="358" width="66" y="350" height="100"/><rect class="bar" x="431" width="66" y="400" height="50"/><rect class="bar" x="504" width="66" y="300.00000000000006" height="149.99999999999994"/><rect class="bar" x="577" width="66" y="350" height="100"/><rect class="bar" x="650" width="66" y="400" height="50"/><rect class="bar" x="723" width="66" y="400" height="50"/></svg>
    <table class="table">
      <thead>
      <tr><th class="text-left">Nationality</th>
      <th class="text-center">Count</th><br>      </tr></thead>
      <tbody>
        <tr>
          <td class="text-left">Italian</td>
          <td class="text-center">5</td>
        </tr>
        <tr>
          <td class="text-left">British</td>
          <td class="text-center">5</td>
        </tr>
        <tr>
          <td class="text-left">Belgian</td>
          <td class="text-center">1</td>
        </tr>
        <tr>
          <td class="text-left">American</td>
          <td class="text-center">9</td>
        </tr>
        <tr>
          <td class="text-left">German</td>
          <td class="text-center">2</td>
        </tr>
        <tr>
          <td class="text-left">Dutch</td>
          <td class="text-center">1</td>
        </tr>
        <tr>
          <td class="text-left">French</td>
          <td class="text-center">3</td>
        </tr>
        <tr>
          <td class="text-left">Spanish</td>
          <td class="text-center">2</td>
        </tr>
        <tr>
          <td class="text-left">New Zealander</td>
          <td class="text-center">1</td>
        </tr>
        <tr>
          <td class="text-left">Swedish</td>
          <td class="text-center">1</td>
        </tr>
      </tbody>
    </table>
</div>
</div>

<p>In diesem Beitrag wird die Erstellung eines Barcharts innerhalb eines Ecmascript 6 Projektes mit Hilfe der der Javascript Bibliothek D3&nbsp;erläutert. </p>
<p><span class="more"></span></p>
<h4 id="data-driven-documents">Data-Driven&nbsp;Documents</h4>
<p>D3 steht für „Data-Driven Documents“ und wird seit 2011 von Mike Bostock als Open-Source-Bibliothek für Datenvisualisierung auf <a href="https://github.com/mbostock/d3">Github</a>  veröffentlicht, kontinuierlich erweitert und optimiert. Die Bibliothek erlaubt die Manipulation des <span class="caps">DOM</span> von HTML-Dokumenten auf der Grundlage von Datensätzen. Dafür nutzt sie die Möglichkeiten moderner Browser wie Chrome, Safari, Firefox, Opera oder IE9+ sowie der aktuellen Webstandards CSS3, HTML5 und SVG. maximale Flexibilität gelegt. Hohe Performance in der Verarbeitung großer Datenmengen und die Möglichkeit der dynamischen Manipulation von Animationen und Interaktionen sind weitere Features des Frameworks. D3 zeichnet sich unter anderem dadurch aus, dass es mit den unterschiedlichsten Dateiformaten umgehen kann. TEXT, JSON, XML, HTML, CSV oder TSV lassen sich – eine valide Datenstruktur vorausgesetzt – problemlos verarbeiten. Neben klassischen Diagrammarten wie Balken- oder Säulendiagrammen lassen sich mit D3 auch komplexere Arten wie Treemaps oder Akkorddiagramme realisieren. Zeitaufwand für die Einarbeitung ist nicht zu unterschätzen, mächtige Werkzeug, dynamic real time data visualizations <sup><a href="#1">1</a></sup>
“D3 allows you to bind arbitrary data to a Document Object Model (<span class="caps">DOM</span>), and then apply data-driven transformations to the document.”<sup><a href="#3">3</a></sup>
D3 is extremely fast, supporting large datasets and dynamic behaviors for interaction and animation. D3’s functional style allows code reuse through a diverse collection of components and plugins.<sup><a href="#3">3</a></sup>
the d3.geo.path function, for example, projects geographic coordinates into <span class="caps">SVG</span> path data. <sup><a href="#3">3</a></sup></p>
<p>Ähnlichkeit zu jQuery
Dieses besteht neben dem Core aus den Komponenten Scales, <span class="caps">SVG</span>, Time, Layouts, Geography, Geometry und Behaviours. Im Kern verankert sind unter anderem Funktionen zur Auswahl von DOM-Elementen, zur Erstellung von Animationen, Verarbeitung von Daten und Manipulation von Farben. Die Bezeichnungen der anderen Komponenten deuten bereits auf ihre Funktionen hin. Eine detaillierte Erklärung findet sich in der <a href="https://github.com/mbostock/d3/wiki/API-Reference"><span class="caps">API</span>-Referenz von D3</a> . Darüber hinaus kann man die Funktionalität wie bei jQuery über Plugins erweitern, sollten die integrierten Möglichkeiten einmal doch nicht ausreichen. Eine weitere Ähnlichkeit zu jQuery ist das praktische Chaining, also das Verketten von Funktionen.<sup><a href="#1">1</a></sup>
“If you have spent time as a front end developer, you know how tedious it can be to modify the <span class="caps">W3C</span> specified DOM.  JQuery’s popularity in recent years is many explained by its approach to simplify this methodology.  jQuery typical calls these “Selectors”.  In d3.js, they work similarly but are called … well “Selections”.” <sup><a href="#2">2</a></sup></p>
<p>Styling
<span class="caps">SVG</span> are Vector Graphics instead of Pixel based graphics and consequently some of the new CSS specifications help us to deal with them.  We are going to want crispEdges so we will include the new shape-rendering: crispEdges to accomplish this. <sup><a href="#2">2</a></sup></p>
<p>Aufbau
Neben der Einbindung von Stylesheets und Skripten empfiehlt es sich, einen <span class="caps">DIV</span>-Container bereitzustellen, in den später das Säulendiagramm gerendert wird. Der Container erhält die frei gewählte ID „bar-chart“ als eindeutigen Selektor 
Code zur Generierung des Säulendiagramms: Zuerst werden die Dimensionen des Diagramms und dessen Randabstände bestimmt. In den Variablen „leftPadding“ und „bottomPadding“ legen wir einen größeren Abstand nach links und unten fest, der für die Darstellung der Achsenlabels notwendig ist.
Skala für die x-Achse. Beim Säulendiagramm nutzt man dafür die Ordinalskala, die D3 mit der Funktion ordinal() bereitstellt. rangeRoundBands sorgt dann dafür, dass die Auswahl an zu verarbeitenden Werten in separate Säulen unterteilt wird. <sup><a href="#1">1</a></sup>
 The rangeRoundBands method computes range values so as to divide the chart area into evenly-spaced, evenly-sized bands, as in a bar chart.<sup><a href="#2">2</a></sup>
leftPadding und width-padding legen den Bereich fest, in dem die Säulen aufgeteilt werden. Auch der Abstand zwischen den Säulen lässt sich einstellen.
Zur linearen Skalierung der y-Achse nutzen wir die Funktion linear(). Der Bereich für die Darstellung der Achse wird mit height - bottomPadding sowie padding definiert. Zu beachten ist hierbei, den Bereich umgekehrt anzugeben, da D3.js immer von y=0 ausgeht.
Definition der beiden Achsen erfolgt nun mit Hilfe des Funktionsaufrufs d3.svg.axis(). Der folgenden Funktion scale() wird mit den Variablen x oder y jeweils übergeben, welche Skalierung genutzt werden soll. Die Lage der Achsenbezeichnung bestimmt man mit Hilfe von orient().
Bevor die <span class="caps">JSON</span>-Daten geladen werden können, muss nun noch das SVG-Element definiert und dem DIV-Container #bar-chart zugewiesen werden. Zur einfacheren Verwendung wird dies ebenfalls als Variable angelegt. <sup><a href="#1">1</a></sup></p>
<p><span class="caps">AJAX</span> INKLUSIVE: LADEN VON&nbsp;DATENSÄTZEN</p>
<p>Eines der Hauptargumente für den Einsatz von D3.js ist die Möglichkeit des asynchronen Ladens von Daten. Dafür stehen komfortable Funktionen zum Datenimport bereit. Der folgende Funktionsaufruf erzeugt einen <span class="caps">AJAX</span>-Request, um die JSON-Datei zu laden, parst den zurückgelieferten Text und speichert ihn in das JavaScript-Objekt data. Ab hier wird der weitere Code innerhalb dieses Callbacks geschrieben, um auf die Daten zugreifen zu können.
zuvor definierten Skalen für x- und y-Achse müssen nun einem Wertebereich zugeordnet werden. Mit der D3-Funktion domain() lassen sich die Werte aus dem gefüllten data-Objekt auf die Achsen mappen. Der Wertebereich der x-Achse ist hier eine Auflistung einzelner Werte, die mit data.map(function(d) { return d.channel; }) der Achse zugeordnet werden. Die Daten lassen sich dabei über den Schlüssel channel auswählen. Für die y-Achse wird der Wertebereich ausgehend von 0 bis zum größten Wert innerhalb des Datensatzes via d3.max() mit dem Schlüssel quantity festgelegt.
Dem SVG-Element wird zunächst ein Element g hinzugefügt.<sup><a href="#1">1</a></sup></p>
<p>g is not actually a d3.js specific element.  It is a methodology in svg to group shapes together. <sup><a href="#2">2</a></sup></p>
<p> Letzterem werden die Klassen axis und abscissa mitgegeben, über die es dann per <span class="caps">CSS</span> gestylt werden kann. Mit Hilfe des transform-Attributes erfolgt die Positionierung der x-Achse innerhalb des Diagramms. Da die zugehörigen Labels recht lang sind, ist es sinnvoll, diese leicht zu drehen und mit etwas Abstand zur Achse zu positionieren. Die abschließend aufgerufene Funktion call() mit der Variablen abscissa wendet die vorherigen Funktionen auf die jeweilige Achse an.
<sup><a href="#1">1</a></sup></p>
<p>Das Zeichnen der y-Achse ist in diesem Fall weniger umfangreich zu beschreiben, da die Labels nicht positioniert werden müssen. Es genügt, die entsprechenden Argumente auszutauschen. Die Aufteilung und Beschriftung der Achse(n) wird vollständig von D3.js übernommen.
Objekt namens barChart erstellt. Dieses enthält den Funktionsaufruf selectAll(“rect”), der im <span class="caps">SVG</span>-Objekt alle übergebenen Rechtecke auswählt. Der Funktion data() werden die Daten zur Verfügung gestellt, und enter() gibt nun genau die zuvor selektierten Elemente zurück.<sup><a href="#1">1</a></sup></p>
<p>Dem barChart-Objekt fügt man nun mittels append(“rect”) die Säulen auf Basis der Daten hinzu. Das Class-Attribut erleichtert auch hier späteres Styling. Schließlich gilt es noch, die Positionierung zu x- und y-Achse vorzunehmen und die Breite der Säulen mit der Funktion x.rangeBand() zuzuordnen.<sup><a href="#1">1</a></sup></p>
<p>Um dem Diagramm Dynamik zu verleihen, werden die Säulen noch mit transition() animiert. Ziel ist es, sie von der x-Achse aus zeitversetzt zu ihrem jeweiligen Maximalwert anwachsen zu lassen. Dazu erhalten die Säulen vor dem Aufruf der Animation eine Höhe von 0. Die Funktion delay() ist für die Verzögerung der Animation zuständig, duration() bestimmt die Dauer in Millisekunden.
Abschließend gilt es noch, <span class="caps">SVG</span>-Text für die Werte in den Säulen mit Hilfe von .append(“text”) zu ergänzen. Hierzu werden die Zahlenwerte zunächst zu den Achsen und Säulen positioniert. Da die meisten D3-Elemente gleichzeitig Objekte und Funktionen sind, lassen sich hier die anfangs definierten Variablen x und y für die Positionierung nutzen, zum Beispiel mit return x(d.channel). Nach der Ausrichtung des Textankers fehlt nur noch die Textausgabe, welche die Aufgabe der Funktion text() ist. <sup><a href="#1">1</a></sup></p>
<p><a id='1'>1</a> vgl. <a href="http://t3n.de/magazin/javascript-bibliothek-d3-237224/">http://t3n.de/magazin/javascript-bibliothek-d3-237224/</a>
<a href="http://d3js.org/">http://d3js.org/</a>
<a id='2'>2</a> vgl. <a href="https://www.linkedin.com/pulse/data-visualizations-using-d3js-brant-snow?trk=seokp_posts_primary_cluster_res_title">https://www.linkedin.com/pulse/data-visualizations-using-d3js-brant-snow?trk=seokp_posts_primary_cluster_res_title</a>
<a id='3'>3</a>  vgl. <a href="http://d3js.org/">http://d3js.org/</a></p>
</section>
        </article>
      </div>
    </div>
    <footer>
      <div class="content-wrap">
        <div class="nav"><a href="/">« Full blog</a></div>
        <section class="about"><p>“Würdest Du mir bitte sagen, welchen Weg ich einschlagen muß?”<br>“Das hängt in beträchtlichem Maße davon ab, wohin du gehen willst”,<br>antwortete die Katze.<br>“Oh, das ist mir ziemlich gleichgültig”,<br>sagte Alice.<br>“Dann ist es auch einerlei, welchen Weg du einschlägst”,<br>meinte die Katze.<br>“Hauptsache, ich komme irgendwohin”,<br>ergänzte sich Alice.<br>“Das wirst du sicher, wenn du lange genug gehst”,<br>sagte die Katze.</p>

        </section>
        <section class="copy">
          <p>&copy; 2016 Mona &mdash; powered by&nbsp;<a href="https://github.com/jnordberg/wintersmith">Wintersmith</a>
          </p>
        </section>
      </div>
    </footer>
  </body>
</html>